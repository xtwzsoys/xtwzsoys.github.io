<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>51单片机定时器与中断系统 - 知识卡片</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
            padding: 30px;
            border-radius: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #3498db;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c, #f39c12);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #2c3e50;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            color: #34495e;
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            border-top: 4px solid;
        }
        
        .card-1 { border-top-color: #3498db; }
        .card-2 { border-top-color: #2ecc71; }
        .card-3 { border-top-color: #e74c3c; }
        .card-4 { border-top-color: #f39c12; }
        .card-5 { border-top-color: #9b59b6; }
        .card-6 { border-top-color: #1abc9c; }
        .card-7 { border-top-color: #34495e; }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .icon-1 { background: linear-gradient(135deg, #3498db, #2980b9); }
        .icon-2 { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .icon-3 { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .icon-4 { background: linear-gradient(135deg, #f39c12, #d35400); }
        .icon-5 { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .icon-6 { background: linear-gradient(135deg, #1abc9c, #16a085); }
        .icon-7 { background: linear-gradient(135deg, #34495e, #2c3e50); }
        
        .card-title {
            font-size: 1.4rem;
            color: #2c3e50;
        }
        
        .card-content {
            font-size: 1rem;
            color: #444;
        }
        
        .card-content ul {
            list-style-type: none;
            padding-left: 5px;
        }
        
        .card-content li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }
        
        .card-content li:before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            margin: 15px 0;
            overflow-x: auto;
            font-size: 0.9rem;
            border-left: 4px solid #3498db;
            position: relative;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #bdc3c7;
            font-size: 0.8rem;
        }
        
        .copy-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
        }
        
        .register-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .register-table th, .register-table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: center;
        }
        
        .register-table th {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-weight: 600;
        }
        
        .register-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .register-table tr:hover {
            background-color: #f0f7ff;
        }
        
        .simulation-container, .case-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
            border-top: 4px solid;
            position: relative;
            overflow: hidden;
        }
        
        .simulation-container { border-top-color: #2ecc71; }
        .case-container { border-top-color: #f39c12; }
        
        .simulation-title, .case-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .simulation-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }
        
        .simulation-box {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        
        .led-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .led {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.7);
            transition: all 0.5s ease;
            position: relative;
        }
        
        .led.on {
            background-color: #2ecc71;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.7);
            animation: pulse 1s infinite;
        }
        
        .timer-display {
            font-size: 2rem;
            text-align: center;
            font-family: 'Consolas', monospace;
            margin: 15px 0;
            color: #2c3e50;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: #3498db;
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-primary:hover { background: #2980b9; }
        .btn-success:hover { background: #27ae60; }
        .btn-danger:hover { background: #c0392b; }
        .btn-warning:hover { background: #d35400; }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .note {
            background: #fff9e6;
            border-left: 4px solid #f1c40f;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        footer {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
            margin-top: 40px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .config-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .bit-container {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .bit {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ecf0f1;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8rem;
            border: 1px solid #ddd;
        }
        
        .bit.active {
            background: #3498db;
            color: white;
        }
        
        .bit-label {
            font-size: 0.7rem;
            text-align: center;
            margin-top: 5px;
            color: #7f8c8d;
        }
        
        .register-explanation {
            margin-top: 15px;
            padding: 15px;
            background: #f0f7ff;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
        
        /* 动画效果 */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .flow-step {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .flow-step.active {
            background: #3498db;
            color: white;
            transform: translateX(10px);
        }
        
        .case-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .case-code {
            flex: 1;
            min-width: 300px;
        }
        
        .case-explanation {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .case-explanation h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .pulse-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        
        .pulse-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .pulse-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .counter-display {
            font-size: 2rem;
            text-align: center;
            margin: 15px 0;
            font-family: 'Consolas', monospace;
            color: #2c3e50;
        }
        
        .case-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .case-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.2rem;
        }
        
        .case-icon-1 { background: #2ecc71; }
        .case-icon-2 { background: #9b59b6; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>51单片机定时器与中断系统</h1>
            <p class="subtitle">核心知识卡片与交互式仿真</p>
        </header>
        
        <div class="cards-container">
            <!-- 定时器基本概念卡片 -->
            <div class="card card-1">
                <div class="card-header">
                    <div class="card-icon icon-1">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h2 class="card-title">定时器基本概念</h2>
                </div>
                <div class="card-content">
                    <p>定时器是单片机的"心脏"，提供精准的时间基准。</p>
                    <ul>
                        <li><span class="highlight">定时模式</span>：对内部时钟计数，用于精准定时</li>
                        <li><span class="highlight">计数模式</span>：对外部脉冲计数，用于频率测量</li>
                        <li><span class="highlight">核心功能</span>：定时、波形生成、脉冲计数</li>
                    </ul>
                    <div class="note">
                        <strong>比喻：</strong>定时器就像人体的心脏，规律跳动为系统提供时间基准。
                    </div>
                </div>
            </div>
            
            <!-- 定时器工作模式卡片 -->
            <div class="card card-2">
                <div class="card-header">
                    <div class="card-icon icon-2">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h2 class="card-title">定时器工作模式</h2>
                </div>
                <div class="card-content">
                    <ul>
                        <li><span class="highlight">模式0</span>：13位定时器 (0-8191)</li>
                        <li><span class="highlight">模式1</span>：16位定时器 (0-65535) - 最常用</li>
                        <li><span class="highlight">模式2</span>：8位自动重装定时器 (0-255)</li>
                        <li><span class="highlight">模式3</span>：双8位定时器 (特殊用途)</li>
                    </ul>
                    <div class="code-block">
                        <div class="code-header">
                            <span>配置示例</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        // 设置定时器0为模式1<br>
                        TMOD = 0x01;
                    </div>
                </div>
            </div>
            
            <!-- 中断系统卡片 -->
            <div class="card card-3">
                <div class="card-header">
                    <div class="card-icon icon-3">
                        <i class="fas fa-bell"></i>
                    </div>
                    <h2 class="card-title">中断系统</h2>
                </div>
                <div class="card-content">
                    <p>中断是单片机的"紧急呼叫系统"。</p>
                    <ul>
                        <li><span class="highlight">中断流程</span>：请求 → 响应 → 执行 → 返回</li>
                        <li><span class="highlight">中断优先级</span>：高级可打断低级</li>
                        <li><span class="highlight">中断源</span>：定时器、外部中断、串口</li>
                    </ul>
                    <div class="note">
                        <strong>比喻：</strong>就像看书时接电话，接完继续看书。
                    </div>
                </div>
            </div>
            
            <!-- 初值计算卡片 -->
            <div class="card card-4">
                <div class="card-header">
                    <div class="card-icon icon-4">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h2 class="card-title">初值计算</h2>
                </div>
                <div class="card-content">
                    <p><span class="highlight">核心公式：</span></p>
                    <p>初值 = 65536 - (所需时间 ÷ 机器周期)</p>
                    <p><span class="highlight">机器周期</span> = 12 ÷ 晶振频率</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>计算示例</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        // 12MHz晶振，定时1ms<br>
                        机器周期 = 12 / 12,000,000 = 1μs<br>
                        初值 = 65536 - (1000μs / 1μs) = 64536 = 0xFC18
                    </div>
                </div>
            </div>
            
            <!-- TMOD寄存器详解卡片 -->
            <div class="card card-5">
                <div class="card-header">
                    <div class="card-icon icon-5">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <h2 class="card-title">TMOD寄存器详解</h2>
                </div>
                <div class="card-content">
                    <p><span class="highlight">TMOD</span> - 定时器模式寄存器 (地址: 89H)</p>
                    <div class="bit-container">
                        <div class="bit">GATE</div>
                        <div class="bit">C/T</div>
                        <div class="bit">M1</div>
                        <div class="bit">M0</div>
                        <div class="bit">GATE</div>
                        <div class="bit">C/T</div>
                        <div class="bit">M1</div>
                        <div class="bit">M0</div>
                    </div>
                    <div class="bit-container">
                        <div class="bit-label">T1 GATE</div>
                        <div class="bit-label">T1 C/T</div>
                        <div class="bit-label">T1 M1</div>
                        <div class="bit-label">T1 M0</div>
                        <div class="bit-label">T0 GATE</div>
                        <div class="bit-label">T0 C/T</div>
                        <div class="bit-label">T0 M1</div>
                        <div class="bit-label">T0 M0</div>
                    </div>
                    
                    <div class="register-explanation">
                        <p><strong>各位功能：</strong></p>
                        <ul>
                            <li><span class="highlight">GATE</span>：门控位 (0: TRx控制, 1: TRx+INTx控制)</li>
                            <li><span class="highlight">C/T</span>：定时/计数选择 (0: 定时器, 1: 计数器)</li>
                            <li><span class="highlight">M1 M0</span>：工作模式 (00: 模式0, 01: 模式1, 10: 模式2, 11: 模式3)</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span>配置示例</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        // 配置T0为模式1，定时器，非门控<br>
                        TMOD = 0x01;<br><br>
                        
                        // 配置T1为模式2，定时器，非门控<br>
                        TMOD = 0x20;
                    </div>
                </div>
            </div>
            
            <!-- TCON寄存器详解卡片 -->
            <div class="card card-6">
                <div class="card-header">
                    <div class="card-icon icon-6">
                        <i class="fas fa-sliders-h"></i>
                    </div>
                    <h2 class="card-title">TCON寄存器详解</h2>
                </div>
                <div class="card-content">
                    <p><span class="highlight">TCON</span> - 定时器控制寄存器 (地址: 88H)</p>
                    <div class="bit-container">
                        <div class="bit">TF1</div>
                        <div class="bit">TR1</div>
                        <div class="bit">TF0</div>
                        <div class="bit">TR0</div>
                        <div class="bit">IE1</div>
                        <div class="bit">IT1</div>
                        <div class="bit">IE0</div>
                        <div class="bit">IT0</div>
                    </div>
                    <div class="bit-container">
                        <div class="bit-label">TF1</div>
                        <div class="bit-label">TR1</div>
                        <div class="bit-label">TF0</div>
                        <div class="bit-label">TR0</div>
                        <div class="bit-label">IE1</div>
                        <div class="bit-label">IT1</div>
                        <div class="bit-label">IE0</div>
                        <div class="bit-label">IT0</div>
                    </div>
                    
                    <div class="register-explanation">
                        <p><strong>各位功能：</strong></p>
                        <ul>
                            <li><span class="highlight">TF1/TF0</span>：定时器溢出标志 (1: 溢出, 0: 未溢出)</li>
                            <li><span class="highlight">TR1/TR0</span>：定时器运行控制 (1: 启动, 0: 停止)</li>
                            <li><span class="highlight">IE1/IE0</span>：外部中断标志</li>
                            <li><span class="highlight">IT1/IT0</span>：外部中断触发方式</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span>配置示例</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        // 启动定时器0<br>
                        TR0 = 1;<br><br>
                        
                        // 检查定时器0是否溢出<br>
                        if(TF0 == 1) {<br>
                        &nbsp;&nbsp;// 处理溢出<br>
                        &nbsp;&nbsp;TF0 = 0; // 软件清除标志<br>
                        }
                    </div>
                </div>
            </div>
            
            <!-- 配置流程卡片 -->
            <div class="card card-7">
                <div class="card-header">
                    <div class="card-icon icon-7">
                        <i class="fas fa-list-ol"></i>
                    </div>
                    <h2 class="card-title">配置流程</h2>
                </div>
                <div class="card-content">
                    <ol>
                        <li>设置工作模式 (TMOD)</li>
                        <li>设置初值 (TH0/TL0)</li>
                        <li>开启中断 (ET0, EA)</li>
                        <li>启动定时器 (TR0)</li>
                        <li>编写中断服务函数</li>
                    </ol>
                    <div class="code-block">
                        <div class="code-header">
                            <span>完整配置示例</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        // 完整配置示例<br>
                        void Timer0_Init() {<br>
                        &nbsp;&nbsp;TMOD &= 0xF0; // 清零T0控制位<br>
                        &nbsp;&nbsp;TMOD |= 0x01; // T0设为模式1<br>
                        &nbsp;&nbsp;TH0 = 0xFC;   // 设置定时初值高8位<br>
                        &nbsp;&nbsp;TL0 = 0x18;   // 设置定时初值低8位<br>
                        &nbsp;&nbsp;ET0 = 1;      // 开启T0中断<br>
                        &nbsp;&nbsp;EA = 1;       // 开启总中断<br>
                        &nbsp;&nbsp;TR0 = 1;      // 启动T0<br>
                        }<br><br>
                        
                        // 中断服务函数<br>
                        void Timer0_ISR() interrupt 1 {<br>
                        &nbsp;&nbsp;TH0 = 0xFC;   // 重装初值<br>
                        &nbsp;&nbsp;TL0 = 0x18;<br>
                        &nbsp;&nbsp;// 用户代码<br>
                        }
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 案例1：LED闪烁 -->
        <div class="case-container">
            <div class="case-header">
                <div class="case-icon case-icon-1">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h2 class="case-title">案例1：定时器实现LED闪烁</h2>
            </div>
            
            <div class="case-content">
                <div class="case-code">
                    <div class="code-block">
                        <div class="code-header">
                            <span>LED闪烁代码</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        #include &lt;reg52.h&gt;<br><br>

                        sbit LED = P1^0;  // LED连接到P1.0口<br>
                        unsigned int count = 0;  // 中断计数器<br><br>

                        // 定时器0初始化函数<br>
                        void Timer0_Init() {<br>
                        &nbsp;&nbsp;TMOD = 0x01;  // 设置定时器0为模式1<br>
                        &nbsp;&nbsp;TH0 = 0x3C;   // 设置定时初值高8位 (50ms)<br>
                        &nbsp;&nbsp;TL0 = 0xB0;   // 设置定时初值低8位 (50ms)<br>
                        &nbsp;&nbsp;ET0 = 1;      // 开启定时器0中断<br>
                        &nbsp;&nbsp;EA = 1;       // 开启总中断<br>
                        &nbsp;&nbsp;TR0 = 1;      // 启动定时器0<br>
                        }<br><br>

                        // 主函数<br>
                        void main() {<br>
                        &nbsp;&nbsp;Timer0_Init();  // 初始化定时器<br>
                        &nbsp;&nbsp;while(1) {      // 主循环<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;// 其他任务可以在这里执行<br>
                        &nbsp;&nbsp;}<br>
                        }<br><br>

                        // 定时器0中断服务函数<br>
                        void Timer0_ISR() interrupt 1 {<br>
                        &nbsp;&nbsp;TH0 = 0x3C;   // 重新装载初值<br>
                        &nbsp;&nbsp;TL0 = 0xB0;<br>
                        &nbsp;&nbsp;count++;      // 中断计数加1<br>
                        &nbsp;&nbsp;if(count == 20) {  // 20次中断 = 1秒<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;count = 0;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;LED = ~LED;  // LED状态取反<br>
                        &nbsp;&nbsp;}<br>
                        }
                    </div>
                </div>
                
                <div class="case-explanation">
                    <h3>案例解析</h3>
                    <p><strong>实现原理：</strong></p>
                    <ul>
                        <li>使用定时器0，模式1（16位定时器）</li>
                        <li>设置初值实现50ms定时</li>
                        <li>每20次中断（50ms × 20 = 1000ms = 1秒）翻转LED状态</li>
                    </ul>
                    
                    <p><strong>关键点：</strong></p>
                    <ul>
                        <li>初值计算：12MHz晶振，50ms定时</li>
                        <li>TH0 = 0x3C, TL0 = 0xB0</li>
                        <li>中断服务函数中需要重装初值</li>
                        <li>使用count变量累计中断次数</li>
                    </ul>
                    
                    <div class="note">
                        <strong>提示：</strong>这种方法是嵌入式系统中常用的精确延时方法，比软件延时更准确，不占用CPU资源。
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 案例2：计数模式 -->
        <div class="case-container">
            <div class="case-header">
                <div class="case-icon case-icon-2">
                    <i class="fas fa-wave-square"></i>
                </div>
                <h2 class="case-title">案例2：定时器计数模式</h2>
            </div>
            
            <div class="case-content">
                <div class="case-code">
                    <div class="code-block">
                        <div class="code-header">
                            <span>计数模式代码</span>
                            <button class="copy-btn">复制</button>
                        </div>
                        #include &lt;reg52.h&gt;<br><br>

                        sbit LED = P1^0;  // LED连接到P1.0口<br>
                        unsigned int pulseCount = 0;  // 脉冲计数器<br><br>

                        // 定时器0初始化函数（计数模式）<br>
                        void Timer0_Init() {<br>
                        &nbsp;&nbsp;TMOD = 0x05;  // 设置定时器0为模式1，计数模式<br>
                        &nbsp;&nbsp;TH0 = 0xFF;   // 设置计数初值高8位<br>
                        &nbsp;&nbsp;TL0 = 0xFB;   // 设置计数初值低8位 (计数5次)<br>
                        &nbsp;&nbsp;ET0 = 1;      // 开启定时器0中断<br>
                        &nbsp;&nbsp;EA = 1;       // 开启总中断<br>
                        &nbsp;&nbsp;TR0 = 1;      // 启动定时器0<br>
                        }<br><br>

                        // 主函数<br>
                        void main() {<br>
                        &nbsp;&nbsp;Timer0_Init();  // 初始化定时器<br>
                        &nbsp;&nbsp;while(1) {      // 主循环<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;// 其他任务可以在这里执行<br>
                        &nbsp;&nbsp;}<br>
                        }<br><br>

                        // 定时器0中断服务函数<br>
                        void Timer0_ISR() interrupt 1 {<br>
                        &nbsp;&nbsp;TH0 = 0xFF;   // 重新装载初值<br>
                        &nbsp;&nbsp;TL0 = 0xFB;<br>
                        &nbsp;&nbsp;pulseCount++;  // 脉冲计数加1<br>
                        &nbsp;&nbsp;LED = ~LED;    // 每次计数到翻转LED<br>
                        }
                    </div>
                    
                    <div class="pulse-counter">
                        <div class="pulse-btn" id="pulseBtn">脉冲</div>
                    </div>
                    <div class="counter-display">脉冲计数: <span id="pulseCount">0</span></div>
                </div>
                
                <div class="case-explanation">
                    <h3>案例解析</h3>
                    <p><strong>实现原理：</strong></p>
                    <ul>
                        <li>使用定时器0，模式1，计数模式</li>
                        <li>TMOD = 0x05 (C/T=1，计数模式)</li>
                        <li>初值设置为0xFFFB，计数5次后溢出</li>
                        <li>每次溢出触发中断，翻转LED状态</li>
                    </ul>
                    
                    <p><strong>关键点：</strong></p>
                    <ul>
                        <li>计数模式对外部引脚(T0)的脉冲进行计数</li>
                        <li>每来一个脉冲，计数器加1</li>
                        <li>计数到最大值后溢出，产生中断</li>
                        <li>常用于测量频率、计数外部事件</li>
                    </ul>
                    
                    <div class="note">
                        <strong>提示：</strong>点击上方的"脉冲"按钮模拟外部脉冲输入，每5次脉冲LED会翻转一次状态。
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 仿真部分 -->
        <div class="simulation-container">
            <h2 class="simulation-title">定时器仿真演示</h2>
            
            <div class="config-panel">
                <h3>配置参数</h3>
                <div class="form-group">
                    <label for="timerMode">定时器模式</label>
                    <select id="timerMode">
                        <option value="1">模式1 (16位定时器)</option>
                        <option value="2">模式2 (8位自动重装)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="crystalFreq">晶振频率 (MHz)</label>
                    <select id="crystalFreq">
                        <option value="12">12 MHz</option>
                        <option value="11.0592">11.0592 MHz</option>
                        <option value="6">6 MHz</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="timeInterval">定时时间 (ms)</label>
                    <select id="timeInterval">
                        <option value="1">1 ms</option>
                        <option value="5">5 ms</option>
                        <option value="10">10 ms</option>
                        <option value="50">50 ms</option>
                    </select>
                </div>
                <div class="controls">
                    <button id="applyConfig" class="btn-primary">应用配置</button>
                </div>
            </div>
            
            <div class="simulation-content">
                <div class="simulation-box">
                    <h3>定时器工作状态</h3>
                    <div class="timer-display" id="timerValue">0x0000</div>
                    <div class="led-container">
                        <div class="led" id="led"></div>
                    </div>
                    <p>定时器状态: <span id="timerStatus">停止</span></p>
                    <p>中断计数: <span id="interruptCount">0</span></p>
                    <div class="controls">
                        <button id="startBtn" class="btn-success">启动定时器</button>
                        <button id="resetBtn" class="btn-danger">重置</button>
                    </div>
                </div>
                
                <div class="simulation-box">
                    <h3>寄存器状态</h3>
                    <table class="register-table">
                        <tr>
                            <th>寄存器</th>
                            <th>值</th>
                            <th>状态</th>
                        </tr>
                        <tr>
                            <td>TMOD</td>
                            <td id="tmodValue">0x01</td>
                            <td>模式1</td>
                        </tr>
                        <tr>
                            <td>TCON</td>
                            <td id="tconValue">0x00</td>
                            <td id="tconStatus">停止</td>
                        </tr>
                        <tr>
                            <td>TH0</td>
                            <td id="th0Value">0xFC</td>
                            <td>高8位</td>
                        </tr>
                        <tr>
                            <td>TL0</td>
                            <td id="tl0Value">0x18</td>
                            <td>低8位</td>
                        </tr>
                        <tr>
                            <td>IE</td>
                            <td id="ieValue">0x82</td>
                            <td>中断使能</td>
                        </tr>
                    </table>
                    
                    <h4 style="margin-top: 20px;">中断流程</h4>
                    <div id="interruptFlow">
                        <div class="flow-step active">1. 主程序运行</div>
                        <div class="flow-step">2. 定时器溢出</div>
                        <div class="flow-step">3. 执行中断服务函数</div>
                        <div class="flow-step">4. 返回主程序</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>51单片机定时器与中断系统知识卡片 &copy; 2023 - 嵌入式开发教学</p>
        </footer>
    </div>

    <script>
        // 仿真逻辑
        document.addEventListener('DOMContentLoaded', function() {
            const timerValue = document.getElementById('timerValue');
            const led = document.getElementById('led');
            const timerStatus = document.getElementById('timerStatus');
            const interruptCount = document.getElementById('interruptCount');
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const applyConfigBtn = document.getElementById('applyConfig');
            const pulseBtn = document.getElementById('pulseBtn');
            const pulseCountDisplay = document.getElementById('pulseCount');
            
            const tmodValue = document.getElementById('tmodValue');
            const tconValue = document.getElementById('tconValue');
            const tconStatus = document.getElementById('tconStatus');
            const th0Value = document.getElementById('th0Value');
            const tl0Value = document.getElementById('tl0Value');
            const ieValue = document.getElementById('ieValue');
            
            const timerMode = document.getElementById('timerMode');
            const crystalFreq = document.getElementById('crystalFreq');
            const timeInterval = document.getElementById('timeInterval');
            
            let timerInterval;
            let count = 0;
            let timerRunning = false;
            let interrupts = 0;
            let currentValue = 0;
            let maxValue = 65535;
            let initialValue = 0xFC18; // 64536
            let pulseCount = 0;
            
            // 计算初值的函数
            function calculateInitialValue() {
                const freq = parseFloat(crystalFreq.value);
                const time = parseInt(timeInterval.value);
                const mode = parseInt(timerMode.value);
                
                // 机器周期 (μs)
                const machineCycle = 12 / freq;
                
                if (mode === 1) {
                    // 模式1: 16位定时器
                    maxValue = 65535;
                    const ticks = time * 1000 / machineCycle; // 转换为μs
                    initialValue = Math.floor(65536 - ticks);
                    
                    // 转换为十六进制
                    const hexValue = initialValue.toString(16).toUpperCase().padStart(4, '0');
                    th0Value.textContent = '0x' + hexValue.substring(0, 2);
                    tl0Value.textContent = '0x' + hexValue.substring(2, 4);
                } else if (mode === 2) {
                    // 模式2: 8位自动重装定时器
                    maxValue = 255;
                    const ticks = time * 1000 / machineCycle; // 转换为μs
                    initialValue = Math.floor(256 - ticks);
                    
                    // 转换为十六进制
                    const hexValue = initialValue.toString(16).toUpperCase().padStart(2, '0');
                    th0Value.textContent = '0x' + hexValue;
                    tl0Value.textContent = '0x' + hexValue;
                }
                
                // 更新TMOD值
                tmodValue.textContent = mode === 1 ? '0x01' : '0x02';
                
                // 重置当前值
                currentValue = initialValue;
                timerValue.textContent = '0x' + currentValue.toString(16).toUpperCase().padStart(4, '0');
            }
            
            // 应用配置
            applyConfigBtn.addEventListener('click', function() {
                calculateInitialValue();
                
                // 如果定时器正在运行，重新启动
                if (timerRunning) {
                    clearInterval(timerInterval);
                    startTimer();
                }
            });
            
            // 启动定时器函数
            function startTimer() {
                timerInterval = setInterval(function() {
                    currentValue++;
                    if (currentValue > maxValue) {
                        currentValue = initialValue;
                        interrupts++;
                        interruptCount.textContent = interrupts;
                        
                        // LED闪烁
                        led.classList.add('on');
                        setTimeout(function() {
                            led.classList.remove('on');
                        }, 200);
                        
                        // 显示中断流程
                        highlightInterruptFlow();
                    }
                    
                    // 更新显示
                    const mode = parseInt(timerMode.value);
                    if (mode === 1) {
                        timerValue.textContent = '0x' + currentValue.toString(16).toUpperCase().padStart(4, '0');
                    } else {
                        timerValue.textContent = '0x' + currentValue.toString(16).toUpperCase().padStart(2, '0');
                    }
                }, 10); // 每10ms更新一次，模拟定时器计数
            }
            
            // 启动/停止定时器
            startBtn.addEventListener('click', function() {
                if (!timerRunning) {
                    // 启动定时器
                    timerRunning = true;
                    startBtn.textContent = '停止定时器';
                    timerStatus.textContent = '运行中';
                    tconValue.textContent = '0x10';
                    tconStatus.textContent = '运行';
                    
                    startTimer();
                } else {
                    // 停止定时器
                    clearInterval(timerInterval);
                    timerRunning = false;
                    startBtn.textContent = '启动定时器';
                    timerStatus.textContent = '停止';
                    tconValue.textContent = '0x00';
                    tconStatus.textContent = '停止';
                }
            });
            
            // 重置
            resetBtn.addEventListener('click', function() {
                clearInterval(timerInterval);
                timerRunning = false;
                startBtn.textContent = '启动定时器';
                timerStatus.textContent = '停止';
                tconValue.textContent = '0x00';
                tconStatus.textContent = '停止';
                interrupts = 0;
                interruptCount.textContent = '0';
                currentValue = initialValue;
                
                const mode = parseInt(timerMode.value);
                if (mode === 1) {
                    timerValue.textContent = '0x' + currentValue.toString(16).toUpperCase().padStart(4, '0');
                } else {
                    timerValue.textContent = '0x' + currentValue.toString(16).toUpperCase().padStart(2, '0');
                }
                
                led.classList.remove('on');
                resetInterruptFlow();
            });
            
            // 脉冲按钮事件
            pulseBtn.addEventListener('click', function() {
                pulseCount++;
                pulseCountDisplay.textContent = pulseCount;
                
                // 每5次脉冲触发一次LED闪烁
                if (pulseCount % 5 === 0) {
                    led.classList.add('on');
                    setTimeout(function() {
                        led.classList.remove('on');
                    }, 300);
                }
                
                // 按钮动画
                pulseBtn.style.transform = 'scale(0.9)';
                setTimeout(function() {
                    pulseBtn.style.transform = 'scale(1)';
                }, 100);
            });
            
            // 中断流程高亮
            function highlightInterruptFlow() {
                const steps = document.querySelectorAll('#interruptFlow .flow-step');
                
                // 重置所有步骤
                steps.forEach(step => {
                    step.classList.remove('active');
                });
                
                // 高亮当前步骤
                let currentStep = 0;
                
                const stepInterval = setInterval(() => {
                    if (currentStep > 0) {
                        steps[currentStep - 1].classList.remove('active');
                    }
                    
                    if (currentStep < steps.length) {
                        steps[currentStep].classList.add('active');
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        // 完成后重置为第一步高亮
                        setTimeout(() => {
                            steps.forEach(step => {
                                step.classList.remove('active');
                            });
                            steps[0].classList.add('active');
                        }, 1000);
                    }
                }, 500);
            }
            
            function resetInterruptFlow() {
                const steps = document.querySelectorAll('#interruptFlow .flow-step');
                steps.forEach(step => {
                    step.classList.remove('active');
                });
                steps[0].classList.add('active');
            }
            
            // 复制按钮功能
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const codeBlock = this.closest('.code-block');
                    const codeText = codeBlock.innerText.replace('复制', '').trim();
                    
                    navigator.clipboard.writeText(codeText).then(() => {
                        const originalText = this.textContent;
                        this.textContent = '已复制!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 2000);
                    });
                });
            });
            
            // 初始化
            calculateInitialValue();
            resetInterruptFlow();
        });
    </script>
</body>
</html>